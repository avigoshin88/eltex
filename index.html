<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Eltex WebRTC Video Player Demo</title>

  <style>
    body {
      width: 100vw;
      min-height: 100vh;
      margin: 0;
    }
  </style>

  <script type="module" src="./src/main.ts"></script>

  <script>
    // const port = 5080;
    const port = 18083;

    const app = "live";
    const stream = "test";
    // const type = "archive";

    let mode = 'archive';

    document.addEventListener("local-sdp-answer-1", (event) => {
      console.log("remote-sdp-answer-1", event.detail);
    });

    function getSDPOffer(app, stream) {
      return fetch(
        `https://evi-webrtc.eltex-co.ru:${port}/index/api/webrtc?app=${app}&stream=${stream}`,
        { method: "GET" }
      )
        .then((response) => response.json())
    }


    function saveOffer(app, stream, type, offer) {
      return fetch(
        `https://evi-webrtc.eltex-co.ru:${port}/index/api/webrtc?app=${app}&stream=${stream}&type=${type}`,
        { method: "POST", body: offer }
      )
        .then((response) => response.json())
    }

    // window.addEventListener('local-sdp-answer-1', (event) => {
    //   console.log('local-sdp-answer-1', event.detail);

    //   saveOffer(app, stream, 'p2p_play', event.detail).then((response) => {
    //     console.log('saveOffer', response);
    //   });
    // });

    let localOffer = null

    window.addEventListener('local-sdp-offer-1', (event) => {
      console.log('local-sdp-offer-1');

      localOffer = event.detail;
    });

    window.addEventListener('request-remote-sdp-offer-1', (event) => {
      console.log('request-remote-sdp-offer-1');

      saveOffer(app, stream, 'archive', localOffer).then((response) => {
        console.log('getSDPOffer', response);

        const event = new CustomEvent("remote-sdp-offer-1", {
          detail: response,
        });

        window.dispatchEvent(event);
      }).catch((error) => {
        console.log(error);

        const event = new CustomEvent("remote-sdp-error-1", {
          detail: error,
        });

        window.dispatchEvent(event);
      })
    });

    // window.onload = () => {
    //   getSDPOffer(app, stream).then((response) => {
    //     console.log('getSDPOffer', response);

    //     const event = new CustomEvent("remote-sdp-offer-1", {
    //       detail: response,
    //     });

    //     window.dispatchEvent(event);
    //   }).catch((error) => {
    //     console.log(error);

    //     const event = new CustomEvent("remote-sdp-error-1", {
    //       detail: error,
    //     });

    //     window.dispatchEvent(event);
    //   })
    // }
  </script>
</head>

<body>
  <div id="app" style="width: 100%">
    <video-player id="1" mode="archive" camera_name="camera_name" ice_servers="stun:evi-webrtc.eltex-co.ru:3478">
    </video-player>
    <!-- <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player>
      <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player>
      <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player>
      <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player>
      <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player>
      <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player>
      <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player>
      <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player>
      <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player>
      <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player>
      <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player>
      <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player>
      <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player>
      <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player>
      <video-player
        api_url="https://evi-webrtc.eltex-co.ru:18083"
        app="live"
        stream="test"
        iceServers="stun:evi-webrtc.eltex-co.ru:3478"
      ></video-player> -->
  </div>
</body>

</html>